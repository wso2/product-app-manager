<%
(function () {
    var user = require('/modules/user.js'),
            usr = user.current(session);

    if (!usr) {
        response.sendError(401, 'Unauthorized');
        return;
    }

    var aid = request.getParameter('asset'),
            store = require('/modules/store.js').store(request, session);

    store.subscribe('gadget', aid);
    response.sendRedirect(request.getParameter('destination'));
})();
%>